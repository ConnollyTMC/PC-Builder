<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Your Cart</title>
<link rel="stylesheet" href="style.css">
<style>
/* PayPal button wrapper to center button */
#paypal-wrapper {
  width: fit-content;          /* shrink wrapper to button width */
  margin: 30px auto 0 auto;    /* 30px top margin, centered horizontally */
}

/* Optional: make it responsive on small screens */
@media (max-width: 500px) {
  #paypal-wrapper {
    width: 90%;   /* button will scale on smaller screens */
  }
}

/* Keep cart items styled nicely */
.configCard {
  background: radial-gradient(1200px 500px at -10% -20%,#1b1f38 0%,#101322 28%,#0c0f1b 55%);
  border: 1px solid #1f2837;
  border-radius: 16px;
  padding: 16px;
  box-shadow: 0 10px 30px #00000055;
  margin-bottom: 18px;
}

.partRow {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 6px;
}

.partRow .price {
  color: #7dd3fc;
  font-weight: 700;
}

.total {
  margin-top: 28px;
  padding: 20px;
  border-radius: 14px;
  background: linear-gradient(90deg,#0e1428,#121a32);
  border: 1px solid #1c2540;
  text-align: center;
}

.total h2 {
  margin: 0 0 6px;
  font-size: 22px;
}

.total .sum {
  font-weight: 800;
  font-size: 28px;
}

.btn {
  display: inline-flex;
  align-items: center;
  gap: 10px;
  margin-top: 12px;
  background: linear-gradient(180deg,#1e90ff,#3aa5ff);
  color: white;
  border: 0;
  border-radius: 14px;
  padding: 12px 18px;
  font-weight: 700;
  cursor: pointer;
  box-shadow: 0 10px 20px #0070ff33;
  transition: transform 0.15s;
}

.btn:active { transform: translateY(1px); }
.btn.clear { background: linear-gradient(180deg,#ef4444,#dc2626); }

.empty {
  text-align: center;
  color: #99a0ae;
  padding: 40px 0;
  font-size: 15px;
  margin-top: 24px;
}
</style>
</head>
<body>
<div class="wrap">
  <header><h1>Your Cart</h1></header>
  
  <div id="cartList"></div>
  
  <div class="total">
    <h2>Total</h2>
    <div id="cartTotal" class="sum">$0</div>
    
    <button class="btn" id="viewBackBtn">Back to PC Builder</button>
    <button class="btn clear" id="clearCartBtn">Clear Cart</button>
    
    <!-- PayPal Button Wrapper -->
    <div id="paypal-wrapper">
      <div id="paypal-button-container"></div>
    </div>
  </div>
</div>

<!-- PayPal SDK -->
<script src="https://www.paypal.com/sdk/js?client-id=YOUR_SANDBOX_CLIENT_ID&currency=USD"></script>

<script>
// --- Utility Functions ---
const $ = id => document.getElementById(id);

function getCart(){ return JSON.parse(localStorage.getItem('cart') || '[]'); }
function setCart(c){ localStorage.setItem('cart', JSON.stringify(c || [])); }

// --- Render Cart ---
function renderCart(){
  const cart = getCart();
  const list = $('cartList');
  list.innerHTML = '';
  let sum = 0;

  if(!cart.length) {
    list.innerHTML = '<div class="empty">Your cart is empty.</div>';
    $('cartTotal').textContent = '$0';
    return;
  }

  cart.forEach((c, i) => {
    const div = document.createElement('div');
    div.className = 'configCard';
    div.innerHTML = `<h3>Configuration ${i+1}</h3>`;
    
    for(const [k,v] of Object.entries(c)){
      if(k==='estTotal') continue;
      div.innerHTML += `<div class="partRow"><div class="label">${k}</div><div class="value">${v||'â€”'}</div></div>`;
    }
    
    div.innerHTML += `<div class="partRow"><div class="label">Subtotal</div><div class="price">${c.estTotal||'$0'}</div></div>`;
    list.appendChild(div);

    const val = parseFloat((c.estTotal||'0').replace(/[^\d.]/g,''))||0;
    sum += val;
  });

  $('cartTotal').textContent = '$'+sum.toLocaleString();
}

// --- Clear Cart ---
function clearCart(){ setCart([]); renderCart(); }

// --- Get Cart Total ---
function getCartTotal(){
  const cart = getCart();
  let total = 0;
  cart.forEach(c=>{
    total += parseFloat((c.estTotal||'0').replace(/[^\d.]/g,'')) || 0;
  });
  return total.toFixed(2);
}

// --- Wire Buttons ---
function wire(){
  $('clearCartBtn').addEventListener('click', clearCart);
  $('viewBackBtn').addEventListener('click', ()=>{ window.location.href='index.html'; });
}

renderCart();
wire();

// --- PayPal Button Integration ---
paypal.Buttons({
  createOrder: function(data, actions){
    const total = getCartTotal();
    if(total === "0.00") {
      alert("Your cart is empty.");
      return;
    }
    return actions.order.create({
      purchase_units: [{
        amount: { value: total },
        description: "Custom PC Order"
      }]
    });
  },
  onApprove: function(data, actions){
    return actions.order.capture().then(function(details){
      alert("Payment completed by " + details.payer.name.given_name);
      clearCart();
    });
  },
  onError: function(err){
    console.error(err);
    alert("Payment failed. Please try again.");
  }
}).render('#paypal-button-container');
</script>
</body>
</html>
