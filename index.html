<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Custom Gaming Desktop Builder</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="wrap">
  <header><h1>Custom Gaming Desktop Builder</h1></header>

  <div class="card" style="margin-bottom:16px;">
    <h3>Filters</h3>
    <div class="row">
      <div>
        <label for="colorFilter">Color</label>
        <select id="colorFilter">
          <option value="all">All Colors</option>
          <option value="black">Black</option>
          <option value="white">White</option>
        </select>
      </div>
    </div>
    <div class="note">If a product has no color specified, it remains visible.</div>
  </div>

  <div class="grid" id="builder">
    <!-- Cards populated by JS -->
    <div class="card">
      <h3>Case</h3>
      <label for="case">Choose a case</label>
      <select id="case"></select>
      <div class="note" id="caseNote">Fan capacity: <span id="fanCap">â€”</span></div>
    </div>
    <div class="card"><h3>Motherboard</h3><label>Choose motherboard</label><select id="motherboard"></select></div>
    <div class="card"><h3>CPU</h3><label>Pick processor</label><select id="cpu"></select></div>
    <div class="card"><h3>CPU Cooler</h3><label>Choose cooler</label><select id="cooler"></select><div class="note">Fans match cooler brand.</div></div>
    <div class="card"><h3>GPU</h3><label>Choose GPU</label><select id="gpu"></select></div>
    <div class="card"><h3>RAM</h3><label>Choose RAM</label><select id="ram"></select></div>
    <div class="card"><h3>Power Supply</h3><label>Choose PSU</label><select id="psu"></select></div>
    <div class="card"><h3>Storage</h3><label>Primary</label><select id="storage1"></select><label>Secondary</label><select id="storage2"></select></div>
    <div class="card">
      <h3>Extra Fans</h3>
      <div class="row">
        <div><label for="fanCount">Extra 120mm fans</label><input type="number" id="fanCount" min="0" value="0"></div>
        <div><label>Per-fan price</label><div id="fanPrice" class="price">$0</div></div>
      </div>
      <div class="err" id="fanErr" style="display:none;">Exceeds case capacity</div>
    </div>
  </div>

  <div class="total">
    <h2>Total</h2>
    <div id="total" class="price">$0</div>
    <button class="btn" id="addToCartBtn">ðŸ›’ Add to cart</button>
    <button class="btn" id="viewCartBtn">ðŸ“‹ View Cart</button>
    <div id="cartMsg" class="note"></div>
  </div>
</div>

<script>
const $ = id => document.getElementById(id);
const fmt = n => `$${Number(n||0).toLocaleString()}`;

let DATA = {}; // loaded from JSON
const FAN_PRICE = { NZXT: 15, Thermaltake: 17 };
const LISTS = { cases:[], motherboards:[], cpus:[], coolers:[], gpus:[], ram:[], psu:[], storage:[] };

function fetchData(){
  fetch('prices.json')
    .then(r=>r.json())
    .then(json=>{
      DATA = json;
      filterAllByColor('all');
      populateAll();
    });
}

function passesColor(item, chosen){
  if(!item||chosen==='all') return true;
  if(!item.color) return true;
  return (Array.isArray(item.color)?item.color:[item.color]).map(s=>s.toLowerCase()).includes(chosen);
}

function filterAllByColor(chosen){
  for(let k in LISTS){
    LISTS[k] = (DATA[k]||[]).filter(x=>passesColor(x,chosen));
  }
}

function optionFor(item){
  const opt=document.createElement('option');
  opt.value=item.sku||item.name;
  opt.textContent=`${item.name} â€” ${fmt(item.price)}`;
  return opt;
}

function populateSelect(id,list){
  const el=$(id); el.innerHTML='';
  list.forEach(it=>el.appendChild(optionFor(it)));
  if(el.options.length>0) el.selectedIndex=0;
}

function populateAll(){
  populateSelect('case',LISTS.cases);
  populateSelect('motherboard',LISTS.motherboards);
  populateSelect('cpu',LISTS.cpus);
  populateSelect('cooler',LISTS.coolers);
  populateSelect('gpu',LISTS.gpus);
  populateSelect('ram',LISTS.ram);
  populateSelect('psu',LISTS.psu);
  populateSelect('storage1',LISTS.storage);
  populateSelect('storage2',LISTS.storage);
  updateCaseNote();
  updateFanPrice();
  calcTotal();
}

function selectedItem(sel,key){return LISTS[key].find(x=>(x.sku||x.name)==$(sel).value);}
function updateCaseNote(){
  const item=selectedItem('case','cases');
  const cap=item?.maxFanSlots||'â€”';
  $('fanCap').textContent=cap;
  const n=parseInt($('fanCount').value)||0;
  $('fanErr').style.display=(cap!=='â€”' && n>cap)?'':'none';
  if(cap!=='â€”') $('fanCount').max=cap;
}
function coolerBrand(){
  const c=selectedItem('cooler','coolers');
  return (c?.brand||'').toLowerCase().includes('thermaltake')?'Thermaltake':'NZXT';
}
function updateFanPrice(){
  const unit=FAN_PRICE[coolerBrand()]||0;
  $('fanPrice').textContent=fmt(unit);
  return unit;
}
function calcTotal(){
  const parts = [
    selectedItem('case','cases')?.price||0,
    selectedItem('motherboard','motherboards')?.price||0,
    selectedItem('cpu','cpus')?.price||0,
    selectedItem('cooler','coolers')?.price||0,
    selectedItem('gpu','gpus')?.price||0,
    selectedItem('ram','ram')?.price||0,
    selectedItem('psu','psu')?.price||0,
    selectedItem('storage1','storage')?.price||0,
    selectedItem('storage2','storage')?.price||0
  ];
  const qty=parseInt($('fanCount').value)||0;
  const sum=parts.reduce((a,b)=>a+b,0)+qty*updateFanPrice();
  $('total').textContent=fmt(sum);
}

function wire(){
  $('colorFilter').addEventListener('change',()=>{filterAllByColor($('colorFilter').value); populateAll();});
  document.querySelectorAll('select,input').forEach(el=>{
    el.addEventListener('change',()=>{updateCaseNote();calcTotal();});
    el.addEventListener('keyup',()=>{updateCaseNote();calcTotal();});
  });
  $('addToCartBtn').addEventListener('click',()=>{
    const payload = {
      case:selectedItem('case','cases')?.name,
      motherboard:selectedItem('motherboard','motherboards')?.name,
      cpu:selectedItem('cpu','cpus')?.name,
      cooler:selectedItem('cooler','coolers')?.name,
      gpu:selectedItem('gpu','gpus')?.name,
      ram:selectedItem('ram','ram')?.name,
      psu:selectedItem('psu','psu')?.name,
      storage1:selectedItem('storage1','storage')?.name,
      storage2:selectedItem('storage2','storage')?.name,
      extraFans:parseInt($('fanCount').value)||0,
      estTotal:$('total').textContent
    };
    const cart=JSON.parse(localStorage.getItem("cart")||"[]");
    cart.push(payload);
    localStorage.setItem("cart", JSON.stringify(cart));
    $('cartMsg').textContent=`âœ… Added to cart: ${payload.estTotal}`;
  });
  $('viewCartBtn').addEventListener('click',()=>{window.location.href='cart.html';});
}

fetchData();
wire();
</script>
</body>
</html>
